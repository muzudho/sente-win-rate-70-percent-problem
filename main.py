# python main.py
import traceback
import random
import math

# å››æ¨äº”å…¥ ğŸ“– [Pythonã§å°æ•°ãƒ»æ•´æ•°ã‚’å››æ¨äº”å…¥ã™ã‚‹roundã¨Decimal.quantize](https://note.nkmk.me/python-round-decimal-quantize/)
from decimal import Decimal, getcontext, ROUND_HALF_UP

# é»’ã€‚å…ˆæ‰‹
BLACK = 1

# ç™½ã€‚å¾Œæ‰‹
WHITE = 2


def coin(black_rate):
    """è¡¨ãŒé»’ã€è£ãŒç™½ã®ã‚³ã‚¤ãƒ³

    Parameters
    ----------
    black_rate : float
        é»’ãŒå‡ºã‚‹ç¢ºç‡ã€‚ä¾‹ï¼š é»’ãŒï¼—å‰²å‡ºã‚‹ãªã‚‰ 0.7
    """
    if random.random() < black_rate:
        return BLACK
    return WHITE


def n_bout(n, black_rate, white_require):
    """ï½æœ¬å‹è² 
    
    n ã¯ã‚³ã‚¤ãƒ³ã‚’æŒ¯ã‚‹å›æ•°ã€‚å…¨éƒ¨é»’ãŒå‡ºãŸã‚‰é»’ã®å‹ã¡ã€white_require å›ç™½ãŒå‡ºã‚Œã°ç™½ã®å‹ã¡ã€‚

    ä¾‹ãˆã° n=1 ãªã‚‰ã€ã‚³ã‚¤ãƒ³ã‚’æœ€å¤§ï¼‘å›æŒ¯ã‚‹ã€‚ï¼‘å‹å…ˆå–ã§å‹ã¡ã€‚
    n=2 ãªã‚‰ã€ã‚³ã‚¤ãƒ³ã‚’æœ€å¤§ï¼’å›æŒ¯ã‚‹ã€‚ï¼’å‹å…ˆå–ã§å‹ã¡ã€‚ç™½ã¯ï¼‘å‹ã®ã‚¢ãƒ‰ãƒãƒ³ãƒ†ãƒ¼ã‚¸ãŒä»˜ã„ã¦ã„ã‚‹ã€‚
    n=3 ãªã‚‰ã€ã‚³ã‚¤ãƒ³ã‚’æœ€å¤§ï¼“å›æŒ¯ã‚‹ã€‚ï¼“å‹å…ˆå–ã§å‹ã¡ã€‚ç™½ã¯ï¼’å‹ã®ã‚¢ãƒ‰ãƒãƒ³ãƒ†ãƒ¼ã‚¸ãŒä»˜ã„ã¦ã„ã‚‹ã€‚
    ä»¥ä¸‹åŒæ§˜ã€‚

    Parameters
    ----------
    n : int
        ï½æœ¬å‹è² 
    black_rate : float
        é»’ç•ªã®å‹ç‡ã€‚ä¾‹ï¼š é»’ç•ªã®å‹ç‡ãŒï¼—å‰²ãªã‚‰ 0.7
    white_require : int
        ç™½ãŒå‹ã¤ã®ã«å¿…è¦ãªç•ªæ•°
    
    Returns
    -------
    winner_color : int
        å‹ã£ãŸæ–¹ã®è‰²
    """
    white_count_down = white_require

    for i in range(0, n):
        if coin(black_rate) == WHITE:
            white_count_down -= 1
            if white_count_down < 1:
                return WHITE

    return BLACK


def n_round(black_win_rate, bout_count, white_require, round_count):
    """ï½å›å¯¾å±€

    ï½å›å¯¾å±€ã—ã¦é»’ãŒå‹ã£ãŸå›æ•°ã‚’è¿”ã™ã€‚
    
    Parameters
    ----------
    black_win_rate : float
        é»’ç•ªã®å‹ç‡ã€‚ä¾‹ï¼š é»’ç•ªãŒï¼—å‰²å‹ã¤ãªã‚‰ 0.7
    bout_count : int
        ï½æœ¬å‹è² ã€‚ä¾‹ï¼š ï¼“æœ¬å‹è² ãªã‚‰ 3
    white_require : int
        ç™½ãŒå‹ã¤ã®ã«å¿…è¦ãªç•ªæ•°
    round_count : int
        ï½å›å¯¾å±€
    
    Returns
    -------
    black_win_count : int
        é»’ã®å‹ã£ãŸæ•°
    """
    black_win_count = 0

    for i in range(0, round_count):
        if n_bout(bout_count, black_win_rate, white_require) == BLACK:
            black_win_count += 1

    return black_win_count


def round_letro(number):
    """å››æ¨äº”å…¥

    ğŸ“– [Pythonã§å°æ•°ãƒ»æ•´æ•°ã‚’å››æ¨äº”å…¥ã™ã‚‹roundã¨Decimal.quantize](https://note.nkmk.me/python-round-decimal-quantize/)

    Parameters
    ----------
    number : float
        å››æ¨äº”å…¥ã—ãŸã„æ•°
    
    Returns
    -------
    answer : int
        æ•´æ•°
    """
    return int(Decimal(str(number)).quantize(Decimal('0'), ROUND_HALF_UP))


########################################
# ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰å®Ÿè¡Œæ™‚
########################################


if __name__ == '__main__':
    """ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰å®Ÿè¡Œæ™‚"""

    try:

        # 0.50 ï½ 0.99 ã¾ã§è©¦ç®—
        rule_list = [
            # black_win_rate, best_black_win_error, best_bout_count, best_round_count, best_white_require
            # -------------------------------------------------------------------------------------------
            # äººã®ç›®ã§è¦‹ã¦ååˆ†ã ã¨æ€ã£ãŸã‚‰ã€best_bout_count ã¨ best_white_require ã‚’ 0 ä»¥å¤–ã«ã™ã‚‹ã“ã¨
            [0.50, 0.0002,  1, 2_000_000,  1],  # r2_000_000 [0.0002  1æœ¬  1é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.51, 0.0094,  1, 2_000_000,  1],  # r2_000_000 [0.0094  1æœ¬  1é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.52, 0.0193,  1, 2_000_000,  1],  # r2_000_000 [0.0193  1æœ¬  1é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.53, 0.0176, 29, 2_000_000, 14],  # r2_000_000 [0.0302  1æœ¬  1é»’  1ç™½][0.0279 27æœ¬ 15é»’ 13ç™½][0.0176 29æœ¬ 16é»’ 14ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.54, 0.0113, 23, 2_000_000, 11],  # r2_000_000 [0.0398  1æœ¬  1é»’  1ç™½][0.0252 21æœ¬ 12é»’ 10ç™½][0.0113 23æœ¬ 13é»’ 11ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.55, 0.0058, 19, 2_000_000,  9],  # r2_000_000 [0.0502  1æœ¬  1é»’  1ç™½][0.0478 15æœ¬  9é»’  7ç™½][0.0253 17æœ¬ 10é»’  8ç™½][0.0058 19æœ¬ 11é»’  9ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.56, 0.0162, 15, 2_000_000,  7],  # r2_000_000 [0.0598  1æœ¬  1é»’  1ç™½][0.0444 13æœ¬  8é»’  6ç™½][0.0164 15æœ¬  9é»’  7ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.57, 0.0142, 13, 2_000_000,  6],  # r2_000_000 [0.0708  1æœ¬  1é»’  1ç™½][0.0498 11æœ¬  7é»’  5ç™½][0.0142 13æœ¬  8é»’  6ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.58, 0.0153, 13, 2_000_000,  6],  # r2_000_000 [0.0798  1æœ¬  1é»’  1ç™½][0.0675  9æœ¬  6é»’  4ç™½][0.0215 11æœ¬  7é»’  5ç™½][0.0153 13æœ¬  8é»’  6ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.59, 0.0048, 11, 2_000_000,  5],  # r2_000_000 [0.0895  1æœ¬  1é»’  1ç™½][0.0419  9æœ¬  6é»’  4ç™½][0.0054 11æœ¬  7é»’  5ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.60, 0.0174,  9, 2_000_000,  4],  # r2_000_000 [0.1001  1æœ¬  1é»’  1ç™½][0.0800  7æœ¬  5é»’  3ç™½][0.0174  9æœ¬  6é»’  4ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.61, 0.0075,  9, 2_000_000,  4],  # r2_000_000 [0.1104  1æœ¬  1é»’  1ç™½][0.0582  7æœ¬  5é»’  3ç™½][0.0077  9æœ¬  6é»’  4ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.62, 0.0032, 12, 2_000_000,  5],  # r2_000_000 [0.1199  1æœ¬  1é»’  1ç™½][0.1156  2æœ¬  2é»’  1ç™½][0.0355  7æœ¬  5é»’  3ç™½][0.0334  9æœ¬  6é»’  4ç™½][0.0032 12æœ¬  8é»’  5ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.63, 0.0129,  7, 2_000_000,  3],  # r2_000_000 [0.1301  1æœ¬  1é»’  1ç™½][0.1029  2æœ¬  2é»’  1ç™½][0.0138  7æœ¬  5é»’  3ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.64, 0.0087,  7, 2_000_000,  3],  # r2_000_000 [0.1402  1æœ¬  1é»’  1ç™½][0.0902  2æœ¬  2é»’  1ç™½][0.0088  7æœ¬  5é»’  3ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.65, 0.0000, 13, 2_000_000,  5],  # r2_000_000 [0.1496  1æœ¬  1é»’  1ç™½][0.0770  2æœ¬  2é»’  1ç™½][0.0716  5æœ¬  4é»’  2ç™½][0.0323  7æœ¬  5é»’  3ç™½][0.0006 13æœ¬  9é»’  5ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.66, 0.0178, 19, 2_000_000,  7],  # r2_000_000 [0.1601  1æœ¬  1é»’  1ç™½][0.0646  2æœ¬  2é»’  1ç™½][0.0520  5æœ¬  4é»’  2ç™½][0.0475  8æœ¬  6é»’  3ç™½][0.0458 11æœ¬  8é»’  4ç™½][0.0317 13æœ¬  9é»’  5ç™½][0.0182 19æœ¬ 13é»’  7ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.67, 0.0174, 11, 2_000_000,  4],  # r2_000_000 [0.1707  1æœ¬  1é»’  1ç™½][0.0509  2æœ¬  2é»’  1ç™½][0.0328  5æœ¬  4é»’  2ç™½][0.0241  8æœ¬  6é»’  3ç™½][0.0178 11æœ¬  8é»’  4ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.68, 0.0118,  5, 2_000_000,  2],  # r2_000_000 [0.1804  1æœ¬  1é»’  1ç™½][0.0378  2æœ¬  2é»’  1ç™½][0.0118  5æœ¬  4é»’  2ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.69, 0.0074,  5, 2_000_000,  2],  # r2_000_000 [0.1903  1æœ¬  1é»’  1ç™½][0.0239  2æœ¬  2é»’  1ç™½][0.0077  5æœ¬  4é»’  2ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.70, 0.0099,  2, 2_000_000,  1],  # r2_000_000 [0.1996  1æœ¬  1é»’  1ç™½][0.0099  2æœ¬  2é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.71, 0.0033,  2, 2_000_000,  1],  # r2_000_000 [0.2105  1æœ¬  1é»’  1ç™½][0.0033  2æœ¬  2é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.72, 0.0182,  2, 2_000_000,  1],  # r2_000_000 [0.2199  1æœ¬  1é»’  1ç™½][0.0189  2æœ¬  2é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.73, 0.0171, 13, 2_000_000,  4],  # r2_000_000 [0.2295  1æœ¬  1é»’  1ç™½][0.0330  2æœ¬  2é»’  1ç™½][0.0175 13æœ¬ 10é»’  4ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.74, 0.0038, 10, 2_000_000,  3],  # r2_000_000 [0.2402  1æœ¬  1é»’  1ç™½][0.0476  2æœ¬  2é»’  1ç™½][0.0047 10æœ¬  8é»’  3ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.75, 0.0187, 18, 2_000_000,  5],  # r2_000_000 [0.2505  1æœ¬  1é»’  1ç™½][0.0623  2æœ¬  2é»’  1ç™½][0.0553  7æœ¬  6é»’  2ç™½][0.0256 10æœ¬  8é»’  3ç™½][0.0194 18æœ¬ 14é»’  5ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.76, 0.0133, 11, 2_000_000,  3],  # r2_000_000 [0.2599  1æœ¬  1é»’  1ç™½][0.0775  2æœ¬  2é»’  1ç™½][0.0604  3æœ¬  3é»’  1ç™½][0.0306  7æœ¬  6é»’  2ç™½][0.0137 11æœ¬  9é»’  3ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.77, 0.0039,  7, 2_000_000,  2],  # r2_000_000 [0.2697  1æœ¬  1é»’  1ç™½][0.0927  2æœ¬  2é»’  1ç™½][0.0437  3æœ¬  3é»’  1ç™½][0.0039  7æœ¬  6é»’  2ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.78, 0.0048, 21, 2_000_000,  5],  # r2_000_000 [0.2798  1æœ¬  1é»’  1ç™½][0.1081  2æœ¬  2é»’  1ç™½][0.0259  3æœ¬  3é»’  1ç™½][0.0225  7æœ¬  6é»’  2ç™½][0.0048 21æœ¬ 17é»’  5ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.79, 0.0066,  3, 2_000_000,  1],  # r2_000_000 [0.2899  1æœ¬  1é»’  1ç™½][0.1240  2æœ¬  2é»’  1ç™½][0.0070  3æœ¬  3é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.80, 0.0114,  3, 2_000_000,  1],  # r2_000_000 [0.3000  1æœ¬  1é»’  1ç™½][0.1401  2æœ¬  2é»’  1ç™½][0.0123  3æœ¬  3é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.81, 0.0133, 12, 2_000_000,  3],  # r2_000_000 [0.3097  1æœ¬  1é»’  1ç™½][0.1563  2æœ¬  2é»’  1ç™½][0.0315  3æœ¬  3é»’  1ç™½][0.0137 14æœ¬ 12é»’  3ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.82, 0.0005,  9, 2_000_000,  2],  # r2_000_000 [0.3199  1æœ¬  1é»’  1ç™½][0.1724  2æœ¬  2é»’  1ç™½][0.0505  3æœ¬  3é»’  1ç™½][0.0476  4æœ¬  4é»’  1ç™½][0.0016  9æœ¬  8é»’  2ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.83, 0.0102, 21, 2_000_000,  4],  # r2_000_000 [0.3300  1æœ¬  1é»’  1ç™½][0.1890  2æœ¬  2é»’  1ç™½][0.0720  3æœ¬  3é»’  1ç™½][0.0255  4æœ¬  4é»’  1ç™½][0.0102 21æœ¬ 18é»’  4ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.84, 0.0013,  4, 2_000_000,  1],  # r2_000_000 [0.3401  1æœ¬  1é»’  1ç™½][0.2059  2æœ¬  2é»’  1ç™½][0.0929  3æœ¬  3é»’  1ç™½][0.0026  4æœ¬  4é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.85, 0.0079, 11, 2_000_000,  2],  # r2_000_000 [0.3501  1æœ¬  1é»’  1ç™½][0.2225  2æœ¬  2é»’  1ç™½][0.1143  3æœ¬  3é»’  1ç™½][0.0219  4æœ¬  4é»’  1ç™½][0.0079 11æœ¬ 10é»’  2ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.86, 0.0087, 19, 2_000_000,  3],  # r2_000_000 [0.3600  1æœ¬  1é»’  1ç™½][0.2396  2æœ¬  2é»’  1ç™½][0.1361  3æœ¬  3é»’  1ç™½][0.0471  4æœ¬  4é»’  1ç™½][0.0301  5æœ¬  5é»’  1ç™½][0.0094 19æœ¬ 17é»’  3ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.87, 0.0015,  5, 2_000_000,  1],  # r2_000_000 [0.3704  1æœ¬  1é»’  1ç™½][0.2563  2æœ¬  2é»’  1ç™½][0.1585  3æœ¬  3é»’  1ç™½][0.0730  4æœ¬  4é»’  1ç™½][0.0019  5æœ¬  5é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.88, 0.0015, 22, 2_000_000,  3],  # r2_000_000 [0.3802  1æœ¬  1é»’  1ç™½][0.2743  2æœ¬  2é»’  1ç™½][0.1819  3æœ¬  3é»’  1ç™½][0.1003  4æœ¬  4é»’  1ç™½][0.0274  5æœ¬  5é»’  1ç™½][0.0259 13æœ¬ 12é»’  2ç™½][0.0016 22æœ¬ 20é»’  3ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.89, 0.0026,  6, 2_000_000,  1],  # r2_000_000 [0.3901  1æœ¬  1é»’  1ç™½][0.2929  2æœ¬  2é»’  1ç™½][0.2048  3æœ¬  3é»’  1ç™½][0.1271  4æœ¬  4é»’  1ç™½][0.0580  5æœ¬  5é»’  1ç™½][0.0034  6æœ¬  6é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.90, 0.0180, 17, 2_000_000,  2],  # r2_000_000 [0.3998  1æœ¬  1é»’  1ç™½][0.3096  2æœ¬  2é»’  1ç™½][0.2298  3æœ¬  3é»’  1ç™½][0.1564  4æœ¬  4é»’  1ç™½][0.0903  5æœ¬  5é»’  1ç™½][0.0312  6æœ¬  6é»’  1ç™½][0.0211  7æœ¬  7é»’  1ç™½][0.0183 17æœ¬ 16é»’  2ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.91, 0.0163,  7, 2_000_000,  1],  # r2_000_000 [0.4100  1æœ¬  1é»’  1ç™½][0.3280  2æœ¬  2é»’  1ç™½][0.2535  3æœ¬  3é»’  1ç™½][0.1857  4æœ¬  4é»’  1ç™½][0.1245  5æœ¬  5é»’  1ç™½][0.0682  6æœ¬  6é»’  1ç™½][0.0165  7æœ¬  7é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.92, 0.0127,  8, 2_000_000,  1],  # r2_000_000 [0.4199  1æœ¬  1é»’  1ç™½][0.3463  2æœ¬  2é»’  1ç™½][0.2783  3æœ¬  3é»’  1ç™½][0.2168  4æœ¬  4é»’  1ç™½][0.1590  5æœ¬  5é»’  1ç™½][0.1063  6æœ¬  6é»’  1ç™½][0.0578  7æœ¬  7é»’  1ç™½][0.0128  8æœ¬  8é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.93, 0.0160, 10, 2_000_000,  1],  # r2_000_000 [0.4299  1æœ¬  1é»’  1ç™½][0.3652  2æœ¬  2é»’  1ç™½][0.3044  3æœ¬  3é»’  1ç™½][0.2480  4æœ¬  4é»’  1ç™½][0.1955  5æœ¬  5é»’  1ç™½][0.1471  6æœ¬  6é»’  1ç™½][0.1013  7æœ¬  7é»’  1ç™½][0.0599  8æœ¬  8é»’  1ç™½][0.0200  9æœ¬  9é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.94, 0.0061, 11, 2_000_000,  1],  # r2_000_000 [0.4402  1æœ¬  1é»’  1ç™½][0.3836  2æœ¬  2é»’  1ç™½][0.3304  3æœ¬  3é»’  1ç™½][0.2809  4æœ¬  4é»’  1ç™½][0.2338  5æœ¬  5é»’  1ç™½][0.1897  6æœ¬  6é»’  1ç™½][0.1483  7æœ¬  7é»’  1ç™½][0.1094  8æœ¬  8é»’  1ç™½][0.0726  9æœ¬  9é»’  1ç™½][0.0390 10æœ¬ 10é»’  1ç™½][0.0061 11æœ¬ 11é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.95, 0.0127, 13, 2_000_000,  1],  # r2_000_000 [0.4499  1æœ¬  1é»’  1ç™½][0.4023  2æœ¬  2é»’  1ç™½][0.3571  3æœ¬  3é»’  1ç™½][0.3139  4æœ¬  4é»’  1ç™½][0.2734  5æœ¬  5é»’  1ç™½][0.2353  6æœ¬  6é»’  1ç™½][0.1979  7æœ¬  7é»’  1ç™½][0.1639  8æœ¬  8é»’  1ç™½][0.1301  9æœ¬  9é»’  1ç™½][0.0991 10æœ¬ 10é»’  1ç™½][0.0686 11æœ¬ 11é»’  1ç™½][0.0406 12æœ¬ 12é»’  1ç™½][0.0127 13æœ¬ 13é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.96, 0.0003, 17, 2_000_000,  1],  # r2_000_000 [0.4598  1æœ¬  1é»’  1ç™½][0.4215  2æœ¬  2é»’  1ç™½][0.3848  3æœ¬  3é»’  1ç™½][0.3493  4æœ¬  4é»’  1ç™½][0.3156  5æœ¬  5é»’  1ç™½][0.2823  6æœ¬  6é»’  1ç™½][0.2511  7æœ¬  7é»’  1ç™½][0.2217  8æœ¬  8é»’  1ç™½][0.1930  9æœ¬  9é»’  1ç™½][0.1650 10æœ¬ 10é»’  1ç™½][0.1382 11æœ¬ 11é»’  1ç™½][0.1128 12æœ¬ 12é»’  1ç™½][0.0880 13æœ¬ 13é»’  1ç™½][0.0641 14æœ¬ 14é»’  1ç™½][0.0421 15æœ¬ 15é»’  1ç™½][0.0205 16æœ¬ 16é»’  1ç™½][0.0003 17æœ¬ 17é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.97, 0.0109, 22, 2_000_000,  1],  # r2_000_000 [0.4701  1æœ¬  1é»’  1ç™½][0.4409  2æœ¬  2é»’  1ç™½][0.4131  3æœ¬  3é»’  1ç™½][0.3854  4æœ¬  4é»’  1ç™½][0.3588  5æœ¬  5é»’  1ç™½][0.3328  6æœ¬  6é»’  1ç™½][0.3078  7æœ¬  7é»’  1ç™½][0.2838  8æœ¬  8é»’  1ç™½][0.2599  9æœ¬  9é»’  1ç™½][0.2373 10æœ¬ 10é»’  1ç™½][0.2156 11æœ¬ 11é»’  1ç™½][0.1936 12æœ¬ 12é»’  1ç™½][0.1729 13æœ¬ 13é»’  1ç™½][0.1527 14æœ¬ 14é»’  1ç™½][0.1332 15æœ¬ 15é»’  1ç™½][0.1146 16æœ¬ 16é»’  1ç™½][0.0958 17æœ¬ 17é»’  1ç™½][0.0776 18æœ¬ 18é»’  1ç™½][0.0605 19æœ¬ 19é»’  1ç™½][0.0438 20æœ¬ 20é»’  1ç™½][0.0279 21æœ¬ 21é»’  1ç™½][0.0109 22æœ¬ 22é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.98, 0.0131, 33, 2_000_000,  1],  # r2_000_000 [0.4802  1æœ¬  1é»’  1ç™½][0.4606  2æœ¬  2é»’  1ç™½][0.4411  3æœ¬  3é»’  1ç™½][0.4222  4æœ¬  4é»’  1ç™½][0.4040  5æœ¬  5é»’  1ç™½][0.3855  6æœ¬  6é»’  1ç™½][0.3680  7æœ¬  7é»’  1ç™½][0.3504  8æœ¬  8é»’  1ç™½][0.3337  9æœ¬  9é»’  1ç™½][0.3172 10æœ¬ 10é»’  1ç™½][0.3010 11æœ¬ 11é»’  1ç™½][0.2846 12æœ¬ 12é»’  1ç™½][0.2689 13æœ¬ 13é»’  1ç™½][0.2533 14æœ¬ 14é»’  1ç™½][0.2392 15æœ¬ 15é»’  1ç™½][0.2242 16æœ¬ 16é»’  1ç™½][0.2094 17æœ¬ 17é»’  1ç™½][0.1954 18æœ¬ 18é»’  1ç™½][0.1805 19æœ¬ 19é»’  1ç™½][0.1672 20æœ¬ 20é»’  1ç™½][0.1542 21æœ¬ 21é»’  1ç™½][0.1415 22æœ¬ 22é»’  1ç™½][0.1283 23æœ¬ 23é»’  1ç™½][0.1156 24æœ¬ 24é»’  1ç™½][0.1036 25æœ¬ 25é»’  1ç™½][0.0910 26æœ¬ 26é»’  1ç™½][0.0793 27æœ¬ 27é»’  1ç™½][0.0681 28æœ¬ 28é»’  1ç™½][0.0564 29æœ¬ 29é»’  1ç™½][0.0463 30æœ¬ 30é»’  1ç™½][0.0346 31æœ¬ 31é»’  1ç™½][0.0239 32æœ¬ 32é»’  1ç™½][0.0131 33æœ¬ 33é»’  1ç™½]  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰
            [0.99, 0     ,  0,         0,  0],
        ]

        # èª¤å·®ã¯ LIMIT ã«æ¥è¿‘ã™ã‚‹ã»ã©ãƒ™ã‚¹ãƒˆã€‚å‹ç‡ã¯æœ€ä½ã§ 0.0ã€æœ€å¤§ã§ 1.0 ãªã®ã§ã€0.5 ã¨ã®èª¤å·®ã¯ 0.5 ãŒæœ€å¤§
        # LIMIT æœªæº€ã‹ã‚‰ã•ã‚‰ã« 0 ã«è¿‘ã¥ã„ã¦ã„ãã®ã§ã€ãã†ãªã‚‹å‰ã«æ‰“ã¡åˆ‡ã‚‹
        LIMIT = 0.02    # ä¾‹ãˆã° LIMIT = 0.03 ã«ã™ã‚‹ã¨ã€é»’ç•ªå‹ç‡ 0.53 ã®ã¨ãã« 0.5 ã¸è¿‘ã¥ã‘ã‚‹ãŸã‚ 0.03 ç¸®ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‰ã€é‹æ‚ªã 1:1 ã®ã¨ãã«å¤–ã™ã¨ã€ãã®ã‚ã¨è¦‹ã¤ã‘ã‚‹ã®ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã‚ˆã†ã 
        OUT_OF_ERROR = 0.51

        for rule in rule_list:
            black_win_rate=rule[0]
            best_black_win_error=rule[1]
            best_bout_count=rule[2]
            best_round_count=rule[3]
            best_white_require=rule[4]

            is_automatic = best_black_win_error >= LIMIT or best_bout_count == 0 or best_round_count < 2_000_000 or best_white_require == 0

            # å…¨éƒ¨å†è¨ˆç®—ã€‚ã‚ã¨ã§æ¶ˆã™
            #is_automatic = True

            # ï¼ˆä»®èª¬ï¼‰ä½•æœ¬å‹è² ã«ã™ã‚‹ã‹ã¯ã€ä»¥ä¸‹ã®å¼ã§æ±‚ã¾ã‚‹
            # bout_count = round_letro(1/(1-black_win_rate)-1)
            # print(f"è©¦ç®—ï¼š 1 / ( 1 - {black_win_rate} ) - 1 = {bout_count} â€»å°æ•°ç‚¹ä»¥ä¸‹å››æ¨äº”å…¥")
            # bout_count = math.floor(1/(1-black_win_rate)-1)
            # print(f"è©¦ç®—ï¼š 1 / ( 1 - {black_win_rate} ) - 1 = {bout_count} â€»å°æ•°ç‚¹ä»¥ä¸‹åˆ‡ã‚Šæ¨ã¦")
            #bout_count = math.ceil(1/(1-black_win_rate)-1)
            #print(f"è©¦ç®—ï¼š 1 / ( 1 - {black_win_rate} ) - 1 = {bout_count} â€»å°æ•°ç‚¹ä»¥ä¸‹åˆ‡ã‚Šä¸Šã’")

            # é€”ä¸­ã®è¨ˆç®—å¼
            calculation_list = []

            # æ¯”ãŒåŒã˜ã«ãªã‚‹ï½æœ¬å‹è² ã¨ç™½ã®ï½å‹å…ˆå–ã®ãƒšã‚¢ã¯ã‚¹ã‚­ãƒƒãƒ—ã—ãŸã„
            ration_set = set()

            # best_bout_count ã¨ best_white_require ãŒæœªè¨­å®šãªã‚‰ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§æ±‚ã‚ã‚‹ã“ã¨ã«ã™ã‚‹
            if is_automatic:
                best_black_win_count = 0
                best_bout_count = 0
                best_white_require = 0
                round_count = 2_000_000

                best_black_win_error = OUT_OF_ERROR

                is_cutoff = False

                for bout_count in range(1, 101):

                    # ï¼‘æœ¬å‹è² ã®ã¨ãã ã‘ã€ç™½ã¯ï½æœ¬ï¼ï¼‘ã§ã¯ãªã„
                    if bout_count == 1:
                        end_white_require = 2
                    else:
                        end_white_require = bout_count

                    for white_require in range(1, end_white_require):

                        # åŒã˜æ¯”ã¯ã‚¹ã‚­ãƒƒãƒ—ã€‚ï¼‘ï¼ï¼ï¼å€ã—ã¦å°æ•°ç‚¹ä»¥ä¸‹å››æ¨äº”å…¥
                        ration = round_letro(white_require / bout_count * 1000)

                        if ration in ration_set:
                            continue

                        ration_set.add(ration)


                        black_win_count = n_round(
                            black_win_rate=black_win_rate,
                            bout_count=bout_count,
                            white_require=white_require,
                            round_count=round_count)
                        
                        #print(f"{black_win_count=}  {round_count=}  {black_win_count / round_count=}")
                        black_win_error = abs(black_win_count / round_count - 0.5)

                        if black_win_error < best_black_win_error:
                            best_black_win_error = black_win_error
                            best_bout_count = bout_count
                            best_black_win_count = black_win_count
                            best_white_require = white_require
                        
                            # é€²æ—ãƒãƒ¼ï¼ˆæ›´æ–°æ™‚ï¼‰
                            text = f'[{best_black_win_error:6.4f} {best_bout_count:2}æœ¬ {best_bout_count-best_white_require+1:2}é»’ {best_white_require:2}ç™½]'
                            calculation_list.append(text)
                            print(text, end='')

                            # ååˆ†ãªç­”ãˆãŒå‡ºãŸã®ã§æ¢ç´¢ã‚’æ‰“ã¡åˆ‡ã‚Šã¾ã™
                            if black_win_error < LIMIT:
                                is_cutoff = True

                                # é€²æ—ãƒãƒ¼
                                print('x', end='')

                                break

                    if is_cutoff:
                        break

                    # é€²æ—ãƒãƒ¼
                    print('.', end='')
                print() # æ”¹è¡Œ

            # best_bout_count ã¨ best_white_require ãŒè¨­å®šã•ã‚Œã¦ã„ã‚Œã°ã€ã‚ˆã‚Šç´°ã‹ãç¢ºç‡ã‚’æ±‚ã‚ã‚‹
            else:
                pass


            with open('result_summary.log', 'a', encoding='utf8') as f:
                # è‡ªå‹•è¨ˆç®—
                if is_automatic:
                    # æœªå®Œäº†
                    if best_black_win_error == OUT_OF_ERROR:
                        text = f"é»’ç•ªå‹ç‡ï¼š{black_win_rate:4.02f}  {''.join(calculation_list)}  ï¼ˆè‡ªå‹•è¨ˆç®—æœªå®Œäº†ï¼‰\n"

                    # æº€äº†
                    else:           
                        text = f"é»’ç•ªå‹ç‡ï¼š{black_win_rate:4.02f}  {best_bout_count:2}æœ¬å‹è² Ã—{round_count:6}å›  é»’{best_bout_count-best_white_require+1:2}æœ¬å…ˆå–/ç™½{best_white_require:2}æœ¬å…ˆå–åˆ¶  èª¿æ•´é»’ç•ªå‹ç‡ï¼š{best_black_win_count * 100 / round_count:>7.04f} ï¼…  {''.join(calculation_list)}  ï¼ˆè‡ªå‹•è¨ˆç®—æº€äº†ï¼‰\n"
                
                # æ‰‹å‹•è¨­å®š
                else:
                    text = f"é»’ç•ªå‹ç‡ï¼š{black_win_rate:4.02f}  {best_bout_count:2}æœ¬å‹è² Ã—{best_round_count:6}å›  é»’{best_bout_count-best_white_require+1:2}æœ¬å…ˆå–/ç™½{best_white_require:2}æœ¬å…ˆå–åˆ¶  èª¿æ•´é»’ç•ªå‹ç‡ï¼š{(best_black_win_error + 0.5) * 100:7.04f} ï¼…  ï¼ˆæ‰‹å‹•è¨­å®šï¼‰\n"

                f.write(text)
                print(text, end='')


    except Exception as err:
        print(f"[unexpected error] {err=}  {type(err)=}")

        # ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹è¡¨ç¤º
        print(traceback.format_exc())

        raise
