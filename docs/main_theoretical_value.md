# イカサマコイン均等化理論

わらべ島の先住民たちは、コインを投げて表と裏のどちらが出るかを当てる遊び（コイントス）を続けていた。  
そして　きふわらべ王国が建国されると、島から出土する金属の材質が悪くなり、表と裏の出る確率が異なるコインしか造ることができなくなった。  
熱心な国民は、表の出る確率を小数点第３位までの精度で測ることができたが、このような材質の悪いコイン（先住民からはイカサマコインと呼ばれた）でコイントスすることは諦めていた。  
そこで、きふわらべ王国の数学大臣はイカサマコインを使っても、まるで表と裏が均等に出たかのように計算できる方法を次のように示した  

もし表の出る確率が７割なら、コインを１回ずつ投げて表裏が出るのを確認する単純作業をするものとし、  
表が７回出たところで投げるのを止め表が出たことにし、  
裏が３回出たところで投げるのを止め裏が出たことにする  
　（きふわらべ王の天秤法　施行）  

国民からは、最大で９回投げるのがツラいと不満が出た  

数学大臣は次の方法を追加することを、きふわらべ王に提案した  

前の話しの続き。７を３で割って余りを四捨五入すれば２が求まる。  
コインを１回ずつ投げて表裏が出るのを確認する単純作業をするものとし、  
裏が１回出たところで投げるのを止め裏が出たことにし、  
表が２回出たところで投げるのを止め表が出たことにする  
　（きふわらべ王の天秤法の比と丸め　草案）

きふわらべ王は、余り（１／３）はどこに行ったと数学大臣を非難した  

数学大臣は修正した次の方法を、きふわらべ王に提案した  

前の話しの続き。７を３で割って余りを切り捨てれば２が求まる。  
コインを１回ずつ投げて表裏が出るのを確認する単純作業をするものとし、  
裏が１回出たところで投げるのを止め裏が出たことにし、  
表が２回出たところで投げるのを止め表が出たことにする。  
切り捨てた余りである１／３は次に持ち越す。  
そして３対局目には余りが集まって１を満たす。これを閏（うるう）対局と呼ぶことにする。  
閏対局では、  
裏が１回出たところで投げるのを止め裏が出たことにし、  
表が３回出たところで投げるのを止め表が出たことにする。  
持ち越している余りから１を減ずる。残りの余りがあれば、次に持ち越す  
　（きふわらべ王の天秤法の比と閏　施行）  

きふわらべ王は、閏対局で表を選ぶことになる者が不憫だと難色を示した  
数学大臣は、閏対局で表を選ぶことになる者がばらけられるように運営でカバーしろ、価値観の違い、と言った


## 説明１　コインの表裏の確率

コインには表と裏がある  

コインの表が出る確率を p と書くとする。  
コインの裏が出る確率は 1 - p となる

例：  

```
p     = 0.7
1 - p = 0.3
```

中でも、コインを投げて、  
表と裏の出る確率が同じとき　均等なコイン、  
表と裏の出る確率が同じでないとき　イカサマコイン  
と呼ぶことにする  

```
p =  0.5    … 均等なコインの確率
p != 0.5    … イカサマコインの確率。 "!=" はノットイコールを表す
```

本書では主に p が 0.5 より大きいイカサマコインを取り扱う  


## 説明２  コインの表裏の確率の整数化

確率の小数部（Decimal places）の桁が消えるほど 10^n を掛けると、整数（Integer）になる

```
scale = 10^n
p_int = scale * p
```

例：  

```
scale = 10
p     =  0.7
p_int =  7
```


## 説明３　先手のｎ本先取

表が出る確率を、裏が出る確率で割り、その整数部を取り出すと、表は何本先取すると勝ちにするかが求まる  

```
※ floor(x) は x の小数点以下切り捨て
p_int = floor(scale * p / (1 - p))
q_int = floor(scale * (1 - p) / p)

p_target = floor(p_int / q_int)
```


## データ

👇 閏対局では、先手はいつもより１本多く取る必要があります  

```
先手勝率0.50  先後勝率整数比　 5： 5  先手の 1本先取制  先手得 0  
先手勝率0.51  先後勝率整数比　51：49  先手の 1本先取制  先手得 2  先手得をチャラにするのに必要な次の閏対局(得 2×25局>=分子49)[第25](新得 1) (得 1×49局>=分子49)[第74](新得 0) (繰り返し)
先手勝率0.52  先後勝率整数比　52：48  先手の 1本先取制  先手得 4  先手得をチャラにするのに必要な次の閏対局(得 4×12局>=分子48)[第12](新得 0) (繰り返し)
先手勝率0.53  先後勝率整数比　53：47  先手の 1本先取制  先手得 6  先手得をチャラにするのに必要な次の閏対局(得 6× 8局>=分子47)[第 8](新得 5) (得 5×10局>=分子47)[第18](新得 3) (得 3×16局>=分子47)[第34](新得 2) (得 2×24局>=分子47)[第58](新得 1) (得 1×47局>=分子47)[第105](新得 0) (繰り返し)
先手勝率0.54  先後勝率整数比　54：46  先手の 1本先取制  先手得 8  先手得をチャラにするのに必要な次の閏対局(得 8× 6局>=分子46)[第 6](新得 6) (得 6× 8局>=分子46)[第14](新得 0) (繰り返し)
先手勝率0.55  先後勝率整数比　55：45  先手の 1本先取制  先手得10  先手得をチャラにするのに必要な次の閏対局(得10× 5局>=分子45)[第 5](新得 5) (得 5× 9局>=分子45)[第14](新得 0) (繰り返し)
先手勝率0.56  先後勝率整数比　56：44  先手の 1本先取制  先手得12  先手得をチャラにするのに必要な次の閏対局(得12× 4局>=分子44)[第 4](新得 8) (得 8× 6局>=分子44)[第10](新得 0) (繰り返し)
先手勝率0.57  先後勝率整数比　57：43  先手の 1本先取制  先手得14  先手得をチャラにするのに必要な次の閏対局(得14× 4局>=分子43)[第 4](新得 1) (得 1×43局>=分子43)[第47](新得 0) (繰り返し)
先手勝率0.58  先後勝率整数比　58：42  先手の 1本先取制  先手得16  先手得をチャラにするのに必要な次の閏対局(得16× 3局>=分子42)[第 3](新得10) (得10× 5局>=分子42)[第 8](新得 8) (得 8× 6局>=分子42)[第14](新得 2) (得 2×21局>=分子42)[第35](新得 0) (繰り返し)
先手勝率0.59  先後勝率整数比　59：41  先手の 1本先取制  先手得18  先手得をチャラにするのに必要な次の閏対局(得18× 3局>=分子41)[第 3](新得 5) (得 5× 9局>=分子41)[第12](新得 4) (得 4×11局>=分子41)[第23](新得 3) (得 3×14局>=分子41)[第37](新得 2) (得 2×21局>=分子41)[第58](新得 1) (得 1×41局>=分子41)[第99](新得 0) (繰り返し)
先手勝率0.60  先後勝率整数比　 6： 4  先手の 1本先取制  先手得 2  先手得をチャラにするのに必要な次の閏対局(得 2× 2局>=分子 4)[第 2](新得 0) (繰り返し)
先手勝率0.61  先後勝率整数比　61：39  先手の 1本先取制  先手得22  先手得をチャラにするのに必要な次の閏対局(得22× 2局>=分子39)[第 2](新得17) (得17× 3局>=分子39)[第 5](新得10) (得10× 4局>=分子39)[第 9](新得 1) (得 1×39局>=分子39)[第48](新得 0) (繰り返し)
先手勝率0.62  先後勝率整数比　62：38  先手の 1本先取制  先手得24  先手得をチャラにするのに必要な次の閏対局(得24× 2局>=分子38)[第 2](新得14) (得14× 3局>=分子38)[第 5](新得 6) (得 6× 7局>=分子38)[第12](新得 2) (得 2×19局>=分子38)[第31](新得 0) (繰り返し)
先手勝率0.63  先後勝率整数比　63：37  先手の 1本先取制  先手得26  先手得をチャラにするのに必要な次の閏対局(得26× 2局>=分子37)[第 2](新得11) (得11× 4局>=分子37)[第 6](新得 8) (得 8× 5局>=分子37)[第11](新得 7) (得 7× 6局>=分子37)[第17](新得 0) (繰り返し)
先手勝率0.64  先後勝率整数比　64：36  先手の 1本先取制  先手得28  先手得をチャラにするのに必要な次の閏対局(得28× 2局>=分子36)[第 2](新得 8) (得 8× 5局>=分子36)[第 7](新得 0) (繰り返し)
先手勝率0.65  先後勝率整数比　65：35  先手の 1本先取制  先手得30  先手得をチャラにするのに必要な次の閏対局(得30× 2局>=分子35)[第 2](新得 5) (得 5× 7局>=分子35)[第 9](新得 0) (繰り返し)
先手勝率0.66  先後勝率整数比　66：34  先手の 1本先取制  先手得32  先手得をチャラにするのに必要な次の閏対局(得32× 2局>=分子34)[第 2](新得 2) (得 2×17局>=分子34)[第19](新得 0) (繰り返し)
先手勝率0.67  先後勝率整数比　67：33  先手の 2本先取制  先手得 1  先手得をチャラにするのに必要な次の閏対局(得 1×33局>=分子33)[第33](新得 0) (繰り返し)
先手勝率0.68  先後勝率整数比　68：32  先手の 2本先取制  先手得 4  先手得をチャラにするのに必要な次の閏対局(得 4× 8局>=分子32)[第 8](新得 0) (繰り返し)
先手勝率0.69  先後勝率整数比　69：31  先手の 2本先取制  先手得 7  先手得をチャラにするのに必要な次の閏対局(得 7× 5局>=分子31)[第 5](新得 6) (得 6× 6局>=分子31)[第11](新得 3) (得 3×11局>=分子31)[第22](新得 0) (繰り返し)
先手勝率0.70  先後勝率整数比　 7： 3  先手の 2本先取制  先手得 1  先手得をチャラにするのに必要な次の閏対局(得 1× 3局>=分子 3)[第 3](新得 0) (繰り返し)
先手勝率0.71  先後勝率整数比　71：29  先手の 2本先取制  先手得13  先手得をチャラにするのに必要な次の閏対局(得13× 3局>=分子29)[第 3](新得 6) (得 6× 5局>=分子29)[第 8](新得 5) (得 5× 6局>=分子29)[第14](新得 1) (得 1×29局>=分子29)[第43](新得 0) (繰り返し)
先手勝率0.72  先後勝率整数比　72：28  先手の 2本先取制  先手得16  先手得をチャラにするのに必要な次の閏対局(得16× 2局>=分子28)[第 2](新得 8) (得 8× 4局>=分子28)[第 6](新得 0) (繰り返し)
先手勝率0.73  先後勝率整数比　73：27  先手の 2本先取制  先手得19  先手得をチャラにするのに必要な次の閏対局(得19× 2局>=分子27)[第 2](新得16) (得16× 2局>=分子27)[第 4](新得 9) (得 9× 3局>=分子27)[第 7](新得 1) (得 1×27局>=分子27)[第34](新得 0) (繰り返し)
先手勝率0.74  先後勝率整数比　74：26  先手の 2本先取制  先手得22  先手得をチャラにするのに必要な次の閏対局(得22× 2局>=分子26)[第 2](新得 8) (得 8× 4局>=分子26)[第 6](新得 2) (得 2×13局>=分子26)[第19](新得 0) (繰り返し)
先手勝率0.75  先後勝率整数比　75：25  先手の 3本先取制  先手得 0
先手勝率0.76  先後勝率整数比　76：24  先手の 3本先取制  先手得 4  先手得をチャラにするのに必要な次の閏対局(得 4× 6局>=分子24)[第 6](新得 0) (繰り返し)
先手勝率0.77  先後勝率整数比　77：23  先手の 3本先取制  先手得 8  先手得をチャラにするのに必要な次の閏対局(得 8× 3局>=分子23)[第 3](新得 5) (得 5× 5局>=分子23)[第 8](新得 2) (得 2×12局>=分子23)[第20](新得 1) (得 1×23局>=分子23)[第43](新得 0) (繰り返し)
先手勝率0.78  先後勝率整数比　78：22  先手の 3本先取制  先手得12  先手得をチャラにするのに必要な次の閏対局(得12× 2局>=分子22)[第 2](新得 6) (得 6× 4局>=分子22)[第 6](新得 0) (繰り返し)
先手勝率0.79  先後勝率整数比　79：21  先手の 3本先取制  先手得16  先手得をチャラにするのに必要な次の閏対局(得16× 2局>=分子21)[第 2](新得15) (得15× 2局>=分子21)[第 4](新得 4) (得 4× 6局>=分子21)[第10](新得 3) (得 3× 7局>=分子21)[第17](新得 1) (得 1×21局>=分子21)[第38](新得 0) (繰り返し)
先手勝率0.80  先後勝率整数比　 8： 2  先手の 4本先取制  先手得 0
先手勝率0.81  先後勝率整数比　81：19  先手の 4本先取制  先手得 5  先手得をチャラにするのに必要な次の閏対局(得 5× 4局>=分子19)[第 4](新得 1) (得 1×19局>=分子19)[第23](新得 0) (繰り返し)
先手勝率0.82  先後勝率整数比　82：18  先手の 4本先取制  先手得10  先手得をチャラにするのに必要な次の閏対局(得10× 2局>=分子18)[第 2](新得 2) (得 2× 9局>=分子18)[第11](新得 0) (繰り返し)
先手勝率0.83  先後勝率整数比　83：17  先手の 4本先取制  先手得15  先手得をチャラにするのに必要な次の閏対局(得15× 2局>=分子17)[第 2](新得 8) (得 8× 3局>=分子17)[第 5](新得 3) (得 3× 6局>=分子17)[第11](新得 2) (得 2× 9局>=分子17)[第20](新得 1) (得 1×17局>=分子17)[第37](新得 0) (繰り返し)
先手勝率0.84  先後勝率整数比　84：16  先手の 5本先取制  先手得 4  先手得をチャラにするのに必要な次の閏対局(得 4× 4局>=分子16)[第 4](新得 0) (繰り返し)
先手勝率0.85  先後勝率整数比　85：15  先手の 5本先取制  先手得10  先手得をチャラにするのに必要な次の閏対局(得10× 2局>=分子15)[第 2](新得 5) (得 5× 3局>=分子15)[第 5](新得 0) (繰り返し)
先手勝率0.86  先後勝率整数比　86：14  先手の 6本先取制  先手得 2  先手得をチャラにするのに必要な次の閏対局(得 2× 7局>=分子14)[第 7](新得 0) (繰り返し)
先手勝率0.87  先後勝率整数比　87：13  先手の 6本先取制  先手得 9  先手得をチャラにするのに必要な次の閏対局(得 9× 2局>=分子13)[第 2](新得 6) (得 6× 3局>=分子13)[第 5](新得 3) (得 3× 5局>=分子13)[第10](新得 0) (繰り返し)
先手勝率0.88  先後勝率整数比　88：12  先手の 7本先取制  先手得 4  先手得をチャラにするのに必要な次の閏対局(得 4× 3局>=分子12)[第 3](新得 0) (繰り返し)
先手勝率0.89  先後勝率整数比　89：11  先手の 8本先取制  先手得 1  先手得をチャラにするのに必要な次の閏対局(得 1×11局>=分子11)[第11](新得 0) (繰り返し)
先手勝率0.90  先後勝率整数比　 9： 1  先手の 9本先取制  先手得 0
先手勝率0.91  先後勝率整数比　91： 9  先手の10本先取制  先手得 1  先手得をチャラにするのに必要な次の閏対局(得 1× 9局>=分子 9)[第 9](新得 0) (繰り返し)
先手勝率0.92  先後勝率整数比　92： 8  先手の11本先取制  先手得 4  先手得をチャラにするのに必要な次の閏対局(得 4× 2局>=分子 8)[第 2](新得 0) (繰り返し)
先手勝率0.93  先後勝率整数比　93： 7  先手の13本先取制  先手得 2  先手得をチャラにするのに必要な次の閏対局(得 2× 4局>=分子 7)[第 4](新得 1) (得 1× 7局>=分子 7)[第11](新得 0) (繰り返し)
先手勝率0.94  先後勝率整数比　94： 6  先手の15本先取制  先手得 4  先手得をチャラにするのに必要な次の閏対局(得 4× 2局>=分子 6)[第 2](新得 2) (得 2× 3局>=分子 6)[第 5](新得 0) (繰り返し)
先手勝率0.95  先後勝率整数比　95： 5  先手の19本先取制  先手得 0
先手勝率0.96  先後勝率整数比　96： 4  先手の24本先取制  先手得 0
先手勝率0.97  先後勝率整数比　97： 3  先手の32本先取制  先手得 1  先手得をチャラにするのに必要な次の閏対局(得 1× 3局>=分子 3)[第 3](新得 0) (繰り返し)
先手勝率0.98  先後勝率整数比　98： 2  先手の49本先取制  先手得 0
先手勝率0.99  先後勝率整数比　99： 1  先手の99本先取制  先手得 0
```
